# 图书管理系统 - 使用说明文档

## 一、系统概述

这是一款基于 C++ 实现的控制台图书管理系统，支持**普通用户**和**管理员**两种身份角色，提供用户注册 / 登录、图书借阅 / 归还、图书管理、用户管理等核心功能，数据通过本地文件持久化存储（书籍数据存于`./books`目录，用户数据存于`./users`目录）。

## 二、环境准备与运行步骤

### 1. 编译环境要求

- 支持 C++17 及以上标准的编译器（GCC 7.0+、Clang 5.0+、MSVC 2017+）
- 需启用文件系统库（编译时若报错，GCC/Clang 需添加链接选项 `-lstdc++fs`）
- 支持控制台 ANSI 颜色输出（Windows 终端需开启「允许使用 ANSI 转义序列」，Linux/macOS 终端默认支持）

### 2. 编译与运行

#### 方式 1：手动编译（GCC 示例）



```
# 1. 将所有源码文件（.cpp、.h）置于同一目录
# 2. 执行编译命令
g++ -std=c++17 *.cpp -o library_system -lstdc++fs
# 3. 运行可执行文件
./library_system  # Linux/macOS
library_system.exe  # Windows
```

#### 方式 2：IDE 编译（VS/CLion 等）

- 创建 C++ 项目，将所有源码文件添加到项目中
- 项目配置中设置 C++ 标准为 C++17
- 编译并运行项目

### 3. 首次运行说明

首次运行系统会自动在当前目录创建`./books`和`./users`两个文件夹，用于存储书籍和用户的持久化数据，无需手动创建。

## 三、核心功能详细使用指南

### 阶段 1：系统初始菜单（未登录状态）

运行程序后，首先进入初始菜单，提供 3 个操作选项，输入对应数字执行操作：

```
************************
* 欢迎使用此管理系统 *
************************
* 请输入数字来操作     *
* 1.登陆               *
* 2.注册               *
* 3.退出               *
************************
```

#### 功能 1：注册（选项 2）

1. 输入数字`2`进入注册流程，系统会引导你依次输入**用户名**和**密码**

2. 注意事项：

   - 用户名不可重复，若输入已存在的用户名，系统会提示「已存在此用户，请重新输入」
   - 密码为明文输入（无隐藏显示），请妥善保管
   - 普通用户注册后身份默认为「用户」，管理员账号需由已有管理员通过「用户管理」功能创建
   - 注册成功后，系统会提示「添加成功」，并自动返回初始菜单

   

3. 后续操作：注册完成后需通过「登录」功能进入系统。

#### 功能 2：登录（选项 1）

1. 输入数字`1`进入登录流程，系统会依次提示输入「用户名」和「密码」
2. 验证逻辑：
   - 若用户名不存在或密码错误，系统提示「用户名或密码错误」，并提供选项「输入 1 退出，其它继续」
   - 输入`1`返回初始菜单，输入其他任意字符可重新输入用户名和密码
3. 登录成功后：
   - 身份为「管理员」：进入**管理员菜单**
   - 身份为「普通用户」：进入**普通用户菜单**
4. 注意事项：登录状态下的数据变更（如借阅书籍、修改密码）会实时写入本地文件，无需手动保存。

#### 功能 3：退出系统（选项 3）

1. 输入数字`3`，直接退出整个图书管理系统
2. 注意事项：退出前的所有操作数据已自动持久化，下次运行程序可恢复上次状态。

### 阶段 2：普通用户菜单（登录身份为「用户」）

登录成功后进入普通用户菜单，提供 4 个操作选项，输入对应数字执行操作：

```
************************
* 用户菜单             *
************************
* 1.搜索书籍           *
* 2.浏览书籍           *
* 3.查看用户信息       *
* 4.退出               *
************************
```

#### 功能 1：搜索书籍（选项 1）

1. 输入数字

   ```
   1
   ```

   进入书籍搜索菜单，支持 3 种搜索方式，输入对应数字选择：

   ```
   ************************
   * 搜索书籍             *
   ************************
   * 1.用书名查询         *
   * 2.用作者查询         *
   * 3.用ISBN/ISSN查询    *
   * 4.返回               *
   ************************
   ```

2. 三种搜索方式操作流程一致（以「用书名查询」为例）：

   - 输入数字`1`，进入书名搜索界面，提示「请输入书名进行查询，按 'e' 返回」
   - 输入要查询的书籍名称，若书籍存在，进入**书籍详情与操作界面**；若不存在，提示「错误输入」并重新等待输入
   - 输入`e`（小写）可返回上一级搜索菜单，输入`4`可返回普通用户菜单

3. 书籍详情与操作界面（搜索成功后进入）：

   - 首先展示书籍完整信息：书名、作者、ISBN、日期、借阅情况、借阅人

   - 随后展示操作选项，选项会根据书籍借阅状态和当前用户身份动态变化：

     ```
     ************************
     * 操作                 *
     ************************
     * 1.查看内容           *
     * 2.借阅（仅书籍未借阅时显示）*
     * 3.归还（仅书籍为当前用户借阅时显示）*
     * e.退出               *
     ************************
     ```

   - 操作说明：

     ① 查看内容（选项 1）：展示书籍的详细内容，停留片刻后自动返回操作菜单

     ② 借阅（选项 2）：仅书籍未被借阅时可用，输入

     ```
     2
     ```

     后，系统提示「借阅成功」，并更新书籍借阅状态（标记为「已借阅」）、当前用户的借阅书籍列表，同时写入本地文件

     ③ 归还（选项 3）：仅书籍为当前用户借阅时可用，输入

     ```
     3
     ```

     后，系统提示「归还成功」，并更新书籍借阅状态（标记为「未借阅」）、当前用户的借阅书籍列表，同时写入本地文件

     ④ 退出（选项 e）：输入小写

     ```
     e
     ```

     ，返回上一级搜索菜单

4. 注意事项：

   - 搜索时输入的书名、作者、ISBN 需与系统中存储的完全一致（区分大小写），否则无法查询到结果
   - 同一本书籍同一时间只能被一位用户借阅，无法重复借阅
   - 借阅书籍后，书籍会同步添加到「我的借阅列表」中，可通过「查看用户信息」功能查看

#### 功能 2：浏览书籍（选项 2）

1. 输入数字

   ```
   2
   ```

   进入书籍列表浏览界面，系统会分页展示所有书籍信息，格式如下：

   ```
   代号 | 书名       | 作者    | ISBN      | 借阅情况
   0    | 三国演义   | 罗贯中  | 978710105 | 未借阅
   1    | 红楼梦     | 曹雪芹  | 978702003 | 已借阅
   ```

2. 分页操作说明：

   - 每页最多展示 9 本书籍，若书籍总数超过 9 本，支持分页切换
   - 输入`n`（小写）：切换到下一页
   - 输入`b`（小写）：切换到上一页（仅非第一页时可用）
   - 输入书籍对应的「代号」（数字 0、1、2...）：进入该书籍的「详情与操作界面」（与搜索书籍后的操作界面一致，支持查看、借阅、归还）
   - 输入`e`（小写）：退出浏览界面，返回普通用户菜单

3. 注意事项：浏览过程中对书籍的操作（借阅、归还）会实时生效，分页列表会在下一次刷新时更新状态。

#### 功能 3：查看用户信息（选项 3）

1. 输入数字

   ```
   3
   ```

   进入用户信息界面，首先展示当前用户的核心信息：

   ```
   ************************
   * 用户信息             *
   ************************
   * 用户名: xxx          *
   * 身份: 用户           *
   * 借阅书籍数: x        *
   ************************
   ```

2. 随后展示用户操作菜单，输入对应数字执行操作：

   ```
   ************************
   * 操作                 *
   ************************
   * 1.查看借阅详情       *
   * 2.更改密码           *
   * 3.返回               *
   ************************
   ```

3. 子功能说明：

   ① 查看借阅详情（选项 1）：进入当前用户的借阅书籍列表，展示格式与「浏览书籍」一致，可查看每本借阅书籍的详情，支持「归还」操作（与书籍详情界面的归还功能一致）

   ② 更改密码（选项 2）：进入密码修改流程，步骤如下：

   - 系统提示「请输入新密码」，输入后确认

   - 系统提示「请再次输入新密码」，输入第二次密码

   - 若两次输入密码不一致，提示「两次输入不一样」，输入`e`退出修改，输入其他字符重新修改

   - 若两次输入一致，提示「更改成功」，新密码会实时写入本地文件，下次登录需使用新密码

     ③ 返回（选项 3）：输入

     ```
     3
     ```

     ，返回普通用户菜单

4. 注意事项：密码修改后不可逆，若忘记新密码，需由管理员通过「用户管理」功能重置为默认密码「123456」。

#### 功能 4：退出（选项 4）

1. 输入数字`4`，退出当前用户登录状态，返回系统初始菜单
2. 注意事项：退出登录不会删除用户数据，下次可使用相同用户名和密码重新登录。

### 阶段 3：管理员菜单（登录身份为「管理员」）

登录成功后进入管理员菜单，提供 3 个操作选项，输入对应数字执行操作：

```
************************
* 管理员菜单           *
************************
* 1.管理书籍           *
* 2.管理用户           *
* 3.退出               *
************************
```

#### 功能 1：管理书籍（选项 1）

1. 输入数字

   ```
   1
   ```

   进入书籍管理菜单，提供 6 个核心操作选项：

   ```
   ************************
   * 书籍管理             *
   ************************
   * 1.搜索书籍           *
   * 2.更改已有书籍       *
   * 3.增加书籍           *
   * 4.删除书籍           *
   * 5.浏览书籍           *
   * 6.返回               *
   ************************
   ```

2. 子功能详细说明：

   ① 搜索书籍（选项 1）：功能与普通用户的「搜索书籍」完全一致，支持书名、作者、ISBN 三种查询方式，可查看书籍详情，不支持借阅 / 归还操作（管理员无借阅权限）

   ② 更改已有书籍（选项 2）：

   - 进入后首先提示「请先找到需要更改的书」，随后进入与「搜索书籍」一致的查询界面

   - 通过书名 / 作者 / ISBN 查询到需要修改的书籍后，自动进入书籍信息修改菜单：

     ```
     ************************
     * 更改书籍信息         *
     ************************
     * 1.更改书名           *
     * 2.更改作者           *
     * 3.更改ISBN/ISSN      *
     * 4.更改借阅情况       *
     * 5.更改内容           *
     * 6.退出               *
     ************************
     ```

   - 各修改项操作说明：

     - 更改书名 / 作者 / ISBN：先展示原信息，再提示输入新信息，输入完成后提示「更改成功」
     - 更改借阅情况：仅支持从「已借阅」改为「未借阅」，无法从未借阅改为已借阅，修改后实时生效
     - 更改内容：先展示原书籍内容，再提示「请输入更改后内容，输入单个字符串 "end" 结束」，输入完成后输入「end」终止编辑，提示「更改成功」

   - 注意事项：修改后的书籍信息会实时写入本地文件，修改 ISBN 时需确保新 ISBN 未被其他书籍占用

     ③ 增加书籍（选项 3）：

   - 进入后系统会依次引导输入书籍信息：书名→作者→ISBN→日期→内容

   - 注意事项：书名、作者、ISBN 均不可重复，若输入重复内容，提示「已存在此 xxx，请重新输入」

   - 输入日期格式要求：如「20070101」（年月日，8 位数字）

   - 输入内容完成后，系统自动创建书籍文件并保存，提示「添加成功」，返回书籍管理菜单

     ④ 删除书籍（选项 4）：

   - 进入后首先提示「请先找到需要删除的书」，随后进入查询界面

   - 通过书名 / 作者 / ISBN 查询到目标书籍后，系统会自动删除该书籍的本地文件，并更新书籍列表

   - 注意事项：书籍删除后不可逆，已借阅的书籍也可删除，删除后对应用户的借阅列表会同步更新

     ⑤ 浏览书籍（选项 5）：功能与普通用户的「浏览书籍」完全一致，支持分页查看所有书籍，可查看书籍详情

     ⑥ 返回（选项 6）：输入

     ```
     6
     ```

     ，返回管理员菜单

#### 功能 2：管理用户（选项 2）

1. 输入数字

   ```
   2
   ```

   进入用户管理菜单，提供 5 个核心操作选项：

   ```
   ************************
   * 用户管理             *
   ************************
   * 1.搜索用户           *
   * 2.更改或删除用户     *
   * 3.增加用户           *
   * 4.浏览用户           *
   * 5.返回               *
   ************************
   ```

2. 子功能详细说明：

   ① 搜索用户（选项 1）：

   - 进入后提示「请输入用户名查找，输入 "exit" 退出」

   - 输入用户名，若存在则展示该用户的详细信息（用户名、身份、借阅书籍数），并提供「查看借阅详情」「更改密码」选项；若不存在则提示「未找到该用户」

   - 输入「exit」（小写）返回用户管理菜单

     ② 更改或删除用户（选项 2）：

   - 进入后首先提示「请先查找需要更改或删除的用户」，随后进入用户搜索界面

   - 查询到目标用户后，进入用户操作菜单：

     ```
     ************************
     * 更改选项             *
     ************************
     * 1.更改               *
     * 2.删除               *
     * 3.返回               *
     ************************
     ```

   - 更改操作（选项 1）：进入用户信息修改菜单，支持 3 项修改：

     - 更改用户名：不可与已有用户重复
     - 重置密码：默认重置为「123456」，重置后用户可使用该密码登录
     - 更改身份：支持在「管理员」和「用户」之间切换

   - 删除操作（选项 2）：输入

     ```
     2
     ```

     后，系统自动删除该用户的本地文件，提示「删除成功」，用户数据不可逆删除

     ③ 增加用户（选项 3）：

   - 与普通用户注册功能类似，但支持选择用户身份（「管理员」或「用户」）

   - 依次输入用户名（不可重复）、密码，选择身份后，提示「添加成功」，返回用户管理菜单

   - 注意事项：这是创建管理员账号的唯一方式，建议谨慎创建管理员账号

     ④ 浏览用户（选项 4）：

   - 进入后分页展示所有用户列表，格式如下：

     ```
     ************************
     * 用户列表             *
     ************************
     * 代号 | 用户名 | 身份 | 借阅书籍数 *
     ----------------------------------
     0    | xxx    | 用户 | 0
     1    | admin  | 管理员 | 0
     ```

   - 分页操作：输入

     ```
     n
     ```

     下一页、

     ```
     b
     ```

     上一页、

     ```
     e
     ```

     退出、数字代号查看用户详情

     ⑤ 返回（选项 5）：输入

     ```
     5
     ```

     ，返回管理员菜单

#### 功能 3：退出（选项 3）

1. 输入数字`3`，退出当前管理员登录状态，返回系统初始菜单
2. 注意事项：管理员的所有操作（如添加书籍、修改用户身份）已实时持久化，无需手动保存。

## 四、常见注意事项与问题排查

### 1. 通用注意事项

- 所有操作均通过「数字」或「指定字符」（如`e`、`n`、`b`）输入，输入其他无关内容会提示「错误输入」，需按提示重新操作
- 输入字符时均为**小写**，大写字符会被判定为无效输入
- 系统运行过程中，请勿手动修改或删除`./books`和`./users`目录下的文件，否则可能导致数据异常
- 书籍的「日期」字段仅用于展示，无格式校验，建议按照「YYYYMMDD」格式输入，保证数据规范性
- 管理员无书籍借阅权限，仅负责系统管理维护

### 2. 常见问题排查

- 问题 1：编译时报错「找不到 std::filesystem」

  解决方案：编译时添加链接选项 

  ```
  -lstdc++fs
  ```

  （GCC/Clang），或确保项目已启用 C++17 及以上标准

- 问题 2：Windows 终端无颜色显示，且排版混乱

  解决方案：开启 Windows 终端的 ANSI 转义序列支持（设置→终端→启用「使用旧版控制台」关闭，或使用 PowerShell/Windows Terminal）

- 问题 3：搜索书籍 / 用户时，明明存在却查询不到

  解决方案：确认输入内容与系统中存储的内容完全一致（区分大小写、无多余空格）

- 问题 4：借阅 / 归还书籍后，用户借阅数未更新

  解决方案：退出当前界面重新进入，或重启程序，数据已持久化，仅需刷新界面即可查看最新状态

- 问题 5：添加书籍时，提示「无法打开文件」

  解决方案：检查当前目录是否有写入权限，避免程序运行在只读目录下

## 五、数据持久化说明

1. 书籍数据：每本书籍对应`./books`目录下一个以「书名」命名的文件，存储内容包括：书名、作者、ISBN、日期、借阅状态、借阅人、书籍内容
2. 用户数据：每个用户对应`./users`目录下一个以「用户名」命名的文件，存储内容包括：用户名、密码（哈希值）、身份、借阅书籍数、借阅书籍 ISBN 列表
3. 所有操作的变更均为实时写入文件，程序退出后数据不会丢失，下次运行程序可完全恢复上次的系统状态。

------

**版本说明**：当前为图书管理系统 V1.0，仅支持控制台交互，后续可扩展图形界面、密码加密存储、书籍分类等功能。

**免责声明**：本系统仅用于学习和课程设计验收，不适合用于生产环境的图书管理场景。